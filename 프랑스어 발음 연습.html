<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Bon Son - í”„ë‘ìŠ¤ì–´ ë°œìŒ ì—°ìŠµ</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f4f8; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; color: #333; }
        .container { width: 90%; max-width: 600px; background-color: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); text-align: center; }
        h1 { color: #4a69bd; margin-bottom: 10px; }
        .selectors { display: flex; gap: 10px; margin-bottom: 20px; }
        .selectors select { flex-grow: 1; padding: 10px; font-size: 1em; border-radius: 8px; border: 1px solid #ddd; }
        #sub-category-selector { display: none; } /* Initially hidden */
        #practiceCard { padding: 20px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 20px; min-height: 120px; display: flex; flex-direction: column; justify-content: center; }
        #frenchText { font-size: 2em; font-weight: bold; color: #1e3799; margin-bottom: 10px; }
        #koreanText { font-size: 1em; color: #777; margin-bottom: 20px; }
        .buttons { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
        button { padding: 15px 25px; font-size: 1.2em; cursor: pointer; border: none; border-radius: 8px; color: white; transition: background-color 0.3s; }
        #listenBtn { background-color: #4a69bd; } #listenBtn:hover { background-color: #3a539b; }
        #speakBtn { background-color: #e67e22; } #speakBtn.recording { background-color: #c0392b; animation: pulse 1.5s infinite; }
        #nextBtn { background-color: #27ae60; } #nextBtn:hover { background-color: #229954; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(192, 57, 43, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(192, 57, 43, 0); } 100% { box-shadow: 0 0 0 0 rgba(192, 57, 43, 0); } }
        #resultArea { min-height: 50px; padding: 15px; border-radius: 8px; background-color: #f9f9f9; }
        #userSaid { font-size: 1.2em; font-weight: 500; }
        .correct { color: #27ae60; } .incorrect { color: #c0392b; }
    </style>
</head>
<body>

<div class="container">
    <h1>Le Bon Son ğŸ‡«ğŸ‡·</h1>
    
    <div class="selectors">
      <select id="category-selector"></select>
      <select id="sub-category-selector"></select>
    </div>

    <div id="practiceCard">
        <h2 id="frenchText"></h2>
        <p id="koreanText"></p>
    </div>
    <div class="buttons">
        <button id="listenBtn">ğŸ”Š ë“£ê¸°</button>
        <button id="speakBtn">ğŸ¤ ë§í•˜ê¸°</button>
    </div>
    <div id="resultArea">
        <p>ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ê³  ì—°ìŠµì„ ì‹œì‘í•˜ì„¸ìš”!</p>
        <p id="userSaid"></p>
    </div>
     <button id="nextBtn">ë‹¤ìŒ ë¬¸ì œ â†’</button>
</div>

<script>
    // --- HTML ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° ---
    const frenchTextElem = document.getElementById('frenchText');
    const koreanTextElem = document.getElementById('koreanText');
    const categorySelector = document.getElementById('category-selector');
    const subCategorySelector = document.getElementById('sub-category-selector');
    const listenBtn = document.getElementById('listenBtn');
    const speakBtn = document.getElementById('speakBtn');
    const nextBtn = document.getElementById('nextBtn');
    const resultArea = document.getElementById('resultArea');
    const userSaidElem = document.getElementById('userSaid');

    let allData = {};
    let currentPracticeSet = [];
    let currentIndex = 0;

    const synth = window.speechSynthesis;
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.lang = 'fr-FR';
    recognition.interimResults = false;

    // --- ë°ì´í„° ë¡œë”© ë° ì´ˆê¸°í™” ---
    window.addEventListener('DOMContentLoaded', async () => {
        try {
            const response = await fetch('data.json');
            allData = await response.json();
            populateCategories();
            loadCategory(); 
        } catch (error) {
            console.error('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', error);
            frenchTextElem.textContent = "ë°ì´í„° ë¡œë”© ì‹¤íŒ¨";
        }
    });

    function populateCategories() {
        const categoryNames = Object.keys(allData);
        categorySelector.innerHTML = categoryNames.map(name => `<option value="${name}">${name}</option>`).join('');
    }

    function populateSubCategories(subCategoryData) {
        const subCategoryNames = Object.keys(subCategoryData);
        subCategorySelector.innerHTML = subCategoryNames.map(name => `<option value="${name}">${name}</option>`).join('');
        subCategorySelector.style.display = 'block';
    }

    function loadCategory() {
        const selectedCategoryName = categorySelector.value;
        const selectedCategoryData = allData[selectedCategoryName];

        // ë°ì´í„° êµ¬ì¡°ê°€ ë°°ì—´ì¸ì§€ ê°ì²´(í•˜ìœ„ ì¹´í…Œê³ ë¦¬ê°€ ìˆëŠ”ì§€) í™•ì¸
        if (Array.isArray(selectedCategoryData)) {
            subCategorySelector.style.display = 'none'; // í•˜ìœ„ ì¹´í…Œê³ ë¦¬ ìˆ¨ê¹€
            currentPracticeSet = selectedCategoryData;
            currentIndex = -1;
            loadNextProblem();
        } else {
            populateSubCategories(selectedCategoryData);
            loadSubCategory(); // ì²« í•˜ìœ„ ì¹´í…Œê³ ë¦¬ ìë™ ë¡œë“œ
        }
        resetResult();
    }

    function loadSubCategory() {
        const selectedCategoryName = categorySelector.value;
        const selectedSubCategoryName = subCategorySelector.value;
        currentPracticeSet = allData[selectedCategoryName][selectedSubCategoryName];
        currentIndex = -1;
        loadNextProblem();
        resetResult();
    }

    function loadNextProblem() {
        if (!currentPracticeSet || currentPracticeSet.length === 0) {
            frenchTextElem.textContent = "ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.";
            koreanTextElem.textContent = "ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.";
            return;
        };
        
        currentIndex = (currentIndex + 1) % currentPracticeSet.length;
        const problem = currentPracticeSet[currentIndex];

        frenchTextElem.textContent = problem.fr;
        koreanTextElem.textContent = problem.ko;
        resetResult();
    }
    
    function resetResult() {
        resultArea.firstChild.textContent = "ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ë”°ë¼ ë§í•´ë³´ì„¸ìš”.";
        userSaidElem.textContent = "";
        userSaidElem.className = "";
    }

    // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
    categorySelector.addEventListener('change', loadCategory);
    subCategorySelector.addEventListener('change', loadSubCategory);
    listenBtn.addEventListener('click', () => { /* ... (ì´í•˜ ë™ì¼) ... */ });
    speakBtn.addEventListener('click', () => { /* ... (ì´í•˜ ë™ì¼) ... */ });
    nextBtn.addEventListener('click', loadNextProblem);
    recognition.onresult = (event) => { /* ... (ì´í•˜ ë™ì¼) ... */ };
    recognition.onend = () => { /* ... (ì´í•˜ ë™ì¼) ... */ };
    recognition.onerror = (event) => { /* ... (ì´í•˜ ë™ì¼) ... */ };


    // --- (ë³€ë™ ì—†ëŠ” ë‚˜ë¨¸ì§€ JS ì½”ë“œ) ---
    listenBtn.addEventListener('click', () => {
        const textToSpeak = frenchTextElem.textContent;
        if (!textToSpeak || synth.speaking) return;
        const utterThis = new SpeechSynthesisUtterance(textToSpeak);
        utterThis.lang = 'fr-FR';
        utterThis.rate = 0.8;
        synth.speak(utterThis);
    });
    speakBtn.addEventListener('click', () => {
        if (!frenchTextElem.textContent || speakBtn.disabled) return;
        speakBtn.classList.add('recording');
        speakBtn.textContent = "ğŸ™ï¸ ë“£ëŠ” ì¤‘...";
        speakBtn.disabled = true;
        recognition.start();
    });
    recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        userSaidElem.textContent = `ğŸ—£ï¸ "${transcript}"`;
        const originalText = frenchTextElem.textContent.toLowerCase().replace(/[?.,!]/g, '').trim();
        const recognizedText = transcript.toLowerCase().replace(/[?.,!]/g, '').trim();
        if (originalText === recognizedText) {
            userSaidElem.className = 'correct';
            resultArea.firstChild.textContent = "ğŸ‰ ì •í™•í•´ìš”!";
        } else {
            userSaidElem.className = 'incorrect';
            resultArea.firstChild.textContent = "ğŸ¤” ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”!";
        }
    };
    recognition.onend = () => {
        speakBtn.classList.remove('recording');
        speakBtn.textContent = "ğŸ¤ ë§í•˜ê¸°";
        speakBtn.disabled = false;
    };
    recognition.onerror = (event) => {
        resultArea.firstChild.textContent = "ì—ëŸ¬: " + event.error;
        recognition.onend();
    };
</script>

</body>
</html>
